// ASTI.K ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–æ—Ç: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –∫–Ω–æ–ø–∫–∞ ¬´–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞¬ª
const { Telegraf, Markup } = require("telegraf");
const express = require("express");

// 1) –¢–æ–∫–µ–Ω
const BOT_TOKEN = process.env.BOT_TOKEN;
if (!BOT_TOKEN) {
  console.error("–ù–µ—Ç BOT_TOKEN –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!");
  process.exit(1);
}

// 2) –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
const bot = new Telegraf(BOT_TOKEN);
const app = express();

// 3) Keep-alive –¥–ª—è Render
app.get("/", (_, res) => res.send("ASTI.K is live"));
app.listen(process.env.PORT || 10000, () => console.log("Server running"));

// 4) –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
bot.start(async (ctx) => {
  await ctx.replyWithHTML(
    "üö® <b>–°—Ç–æ–ø. –¢—ã –≤ –∑–æ–Ω–µ ASTI.K.</b>\n" +
    "–ó–¥–µ—Å—å –Ω–µ—Ç —Ñ–∞–ª—å—à–∏–≤—ã—Ö –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤ –∏ —Ä–æ–∑–æ–≤—ã—Ö —Å–æ–ø–ª–µ–π.\n\n" +
    "–Ø ‚Äî –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π:\n" +
    "üí£ –†–∞–∑–Ω–µ—Å—ë—Ç —Ç–≤–æ–∏ –º–æ–¥–Ω—ã–µ –∏–ª–ª—é–∑–∏–∏.\n" +
    "ü©∏ –ü–æ–∫–∞–∂–µ—Ç, –ø–æ—á–µ–º—É —Ç–≤–æ–∏ –≤–µ—â–∏ —Ä–µ–∞–ª—å–Ω–æ ¬´—Å—Ç–∞—Ä—è—Ç¬ª –∏–ª–∏ ¬´–¥–µ—à–µ–≤—è—Ç¬ª.\n" +
    "‚ö°Ô∏è –°–∫–∞–∂–µ—Ç, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥–µ—Ç—å –¥–æ—Ä–æ–∂–µ –∏ —É–≤–µ—Ä–µ–Ω–Ω–µ–µ.\n\n" +
    "üß© –ù–∞—á–Ω—ë–º —Å <b>–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Ñ–∏–≥—É—Ä—ã</b>.\n" +
    "–≠—Ç–æ –Ω–µ —Ç–µ—Å—Ç –∏–∑ –∂—É—Ä–Ω–∞–ª–∞ ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä—ã–π —Ä–∞–∑–±–æ—Ä: –≥–¥–µ —É —Ç–µ–±—è +100 –∫ —Å—Ç–∏–ª—é, –∞ –≥–¥–µ üîª –º–∏–Ω—É—Å.\n\n" +
    "üëâ –ì–æ—Ç–æ–≤–∞ –∫ —á–µ—Å—Ç–Ω–æ–º—É –∑–µ—Ä–∫–∞–ª—É?",
    Markup.inlineKeyboard([
      [Markup.button.callback("üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", "diag_start")]
    ])
  );
});

// 5) –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ (—á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞–ª–æ)
bot.action("diag_start", async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.replyWithHTML(
    "–û–∫–µ–π. –ù–∞—á–Ω—ë–º.\n\n" +
    "–ù–∞–ø–∏—à–∏ <b>—Ä–æ—Å—Ç</b> (—Å–º) –∏ <b>–≤–µ—Å</b> (–∫–≥) –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É.\n" +
    "–ü—Ä–∏–º–µ—Ä: <code>168 / 62</code>"
  );
});

// 6) –ó–∞–ø—É—Å–∫
bot.launch();
